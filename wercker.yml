box: node
build:
  steps:
    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"
    - npm-install
    - script:
        name: npm install global
        code: sudo npm install -g grunt-cli mocha cordova
    - script:
        name: unit test
        code: npm run test:unit
    - script:
        name: install material-ui
        code: cd node_modules/material-ui && npm install && npm run build && rm -r node_modules/react node_modules/babel-core .babelrc && cd ../../
    - script:
        name: build for testing the release
        code: npm run browser:production
    - script:
        name: clean directory
        code: rm -rf .git

deploy:
  steps:
    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"
    # The env between build and deploy is different
    - script:
        name: npm install global
        code: sudo npm install -g grunt-cli
    - script:
        name: build
        code: npm run $NPM_COMMAND
    - add-ssh-key:
        keyname: SSH_KEY
        host: $OPENSHIFT_HOST
    - add-to-known_hosts:
        hostname: $OPENSHIFT_HOST
    - script:
        name: git deploy cordova
        code: ./deploy.sh $OPENSHIFT_GIT_URL
